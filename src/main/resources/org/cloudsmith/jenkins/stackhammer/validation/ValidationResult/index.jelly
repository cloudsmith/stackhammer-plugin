<j:jelly xmlns:j="jelly:core" xmlns:st="jelly:stapler" xmlns:d="jelly:define"
	xmlns:l="/lib/layout" xmlns:t="/lib/hudson" xmlns:f="/lib/form">

	<l:layout title="Stack Hammer">
		<l:main-panel>
		   <script type="text/javascript">
		      function showOrHideElement(id) {
		         var element = document.getElementById(id);
		         if (document.getElementById(id).style.display == "none") {
		            document.getElementById(id).style.display = "";
		         } else if (document.getElementById(id).style.display == "") {
		            document.getElementById(id).style.display = "none";
		         }
		      }
		   </script>
		
			<h1>Stack Hammer Validation Diagnostics</h1>
			<h2>Errors and Warnings</h2>
			<j:choose>
				<j:when test="${it.validationDiagnosticsCount != 0}">
					<a href="javascript:showOrHideElement('validationDiagnosticsTable')">hide/expand the table</a>
					<table id="validationDiagnosticsTable" border="1px" class="pane sortable">
						<thead>
							<tr>
								<td class="pane-header">Severity</td>
								<td class="pane-header">Resource</td>
								<td class="pane-header">Message</td>
							</tr>
						</thead>
						<tbody>
							<j:forEach var="diag" items="${it.validationDiagnostics}">
								<j:if test="${diag.resourcePath != null}">
									<tr>
										<td>${diag.severityString}:</td>
										<td>
											<j:choose>
												<j:when test="${diag.line != 0}">
													<a href="${it.stackBase}${diag.resourcePath}#L${diag.line}" target="_blank">${diag.resourcePath}: ${diag.line}</a>:
												</j:when>
												<j:otherwise>
													<a href="${it.stackBase}${diag.resourcePath}" target="_blank">${diag.resourcePath}</a>:
												</j:otherwise>
											</j:choose>
										</td>
										<td>${diag.message}</td>
									</tr>
								</j:if>
							</j:forEach>
						</tbody>
					</table>
				</j:when>
				<j:otherwise>The validation did not produce any diagnostics</j:otherwise>
			</j:choose>
			<h2>Dependency Graph</h2>
			<a href="javascript:showOrHideElement('validationGraph')">hide/expand the graph</a><br/>
			<object id="validationGraph" data="${it.validationGraphURL}" width="98%"/>
		</l:main-panel>
	</l:layout>
</j:jelly>
